# 更新说明 - 参考 JSON Hero 优化

## 🎉 重大更新

参考了优秀的开源项目 [JSON Hero](https://github.com/triggerdotdev/jsonhero-web) 的设计理念，我们为项目添加了全新的列视图功能！

---

## ✨ 新增功能

### 1. 列视图（Column View）⭐

灵感来自 macOS Finder 和 JSON Hero，提供直观的多列浏览方式：

**主要特性：**

- 📂 **多列展示**：每一列显示当前层级的所有字段
- 🎯 **点击导航**：点击对象或数组自动展开到下一列
- 📍 **路径追踪**：底部显示当前选中项的完整路径
- 🏷️ **类型标识**：自动识别并显示值的类型图标
- 👀 **值预览**：每个字段显示简短的值预览

**支持的类型图标：**

- 📄 `object` - 对象
- 📋 `array` - 数组
- 🔤 `string` - 字符串
- 🔢 `number` - 数字
- 📅 `date` - 日期
- 🔗 `url` - 链接
- 🖼️ `image` - 图片

**使用方法：**

1. 点击"列视图"标签切换到列视图模式
2. 在左侧列中点击任意字段
3. 如果是对象或数组，会在右侧展开新列
4. 继续向右浏览，探索深层数据结构

### 2. 详情面板（Detail Panel）

为列视图配备的强大信息面板：

**显示内容：**

- 📍 **完整路径**：选中项在 JSON 中的准确位置
- 🏷️ **数据类型**：带颜色标识的类型徽章
- 📏 **大小信息**：字节大小（自动格式化为 B/KB/MB）
- 📊 **统计信息**：
  - 数组：元素数量
  - 对象：属性数量
  - 字符串：字符数
- 🎨 **值预览**：根据类型智能渲染：
  - 代码高亮
  - 数学公式渲染
  - 图片展示
  - 工具调用可视化
  - 格式化 JSON

**功能：**

- 📋 **一键复制**：点击复制按钮快速复制值
- 🔄 **实时更新**：选择不同字段时自动更新
- 👁️ **可隐藏**：点击面板图标切换显示/隐藏

### 3. 增强的视图切换

现在提供 **4 种** 查看模式（原来是 3 种）：

| 模式 | 图标 | 说明 | 最适合 |
|------|------|------|--------|
| 列视图 | 📊 | macOS 风格多列浏览 + 详情面板 | **浏览和探索复杂JSON结构**（推荐） |
| 智能视图 | 👁️ | 自动识别类型并特殊渲染 | 查看包含代码/公式/图片的数据 |
| JSON树 | 📋 | 交互式树形结构 | 查看层级关系 |
| 原始数据 | 📄 | 格式化的纯文本 | 复制或导出 |

---

## 🎨 UI/UX 改进

### 视觉优化

- ✨ **选中高亮**：列视图中选中的项使用主题色高亮
- 🎯 **清晰的层级**：每列之间有明显的分隔线
- 📊 **类型徽章**：不同类型使用不同的颜色标识
- 💫 **流畅动画**：鼠标悬停和点击都有平滑过渡

### 交互优化

- ⌨️ **键盘友好**：支持 Tab 键在各列之间切换
- 📱 **响应式**：在移动设备上详情面板自动调整为底部显示
- 🖱️ **鼠标体验**：悬停效果清晰，点击反馈明确

---

## 📦 新增文件

```bash
src/components/
├── ColumnView.tsx         # 列视图组件
├── ColumnView.css         # 列视图样式
├── DetailPanel.tsx        # 详情面板组件
└── DetailPanel.css        # 详情面板样式
```

---

## 🔧 技术实现

### 核心算法

1. 路径构建

```typescript
const path = parentPath ? `${parentPath}.${key}` : key
```

使用点号分隔的路径字符串，数组使用 `[index]` 表示。

2. 类型检测

```typescript
getValueType(value) {
  if (Array.isArray(value)) return 'array'
  if (typeof value === 'object') return 'object'
  // 特殊字符串检测
  if (/^\d{4}-\d{2}-\d{2}/.test(value)) return 'date'
  if (/^https?:\/\/.*\.(jpg|png)$/.test(value)) return 'image'
  // ...
}
```

3. 列数据构建

```typescript
buildNodes(obj, parentPath) {
  // 遍历对象/数组
  // 为每个字段创建节点
  // 包含 key, value, path, type 信息
}
```

### 状态管理

使用 React Hooks 管理状态：

- `selectedPath` - 当前选中的路径
- `selectedValue` - 当前选中的值
- `showDetail` - 详情面板显示状态
- `columns` - 列数据数组

---

## 📚 使用示例

### 基础用法

```json
{
  "user": {
    "name": "张三",
    "age": 25,
    "skills": ["JavaScript", "Python", "React"]
  }
}
```

**在列视图中：**

1. 第一列显示：`user`
2. 点击 `user` → 第二列显示：`name`, `age`, `skills`
3. 点击 `skills` → 第三列显示：`[0]`, `[1]`, `[2]`
4. 点击 `[0]` → 详情面板显示 `"JavaScript"`

### 复杂结构

```json
{
  "data": {
    "items": [
      {
        "id": 1,
        "code": {
          "language": "python",
          "content": "print('Hello')"
        }
      }
    ]
  }
}
```

**导航路径：**

- `data` → `items` → `[0]` → `code` → `content`
- 详情面板会自动检测并高亮显示 Python 代码

---

## 🎯 对比 JSON Hero

### 相似之处

✅ 列式浏览界面  
✅ 路径导航  
✅ 类型识别  
✅ 详情面板

### 我们的特色

⭐ **LLM 数据专项支持**：

- 数学公式渲染（LaTeX）
- 工具调用可视化
- 推理过程高亮
- Agent 对话展示

⭐ **多视图切换**：

- 保留了原有的智能视图、JSON树、原始数据视图
- 可以根据使用场景灵活切换

⭐ **中文优化**：

- 完整的中文界面
- 中文文档和说明

---

## 🚀 性能优化

- ✅ 使用 `useMemo` 缓存计算结果
- ✅ 列数据按需构建，不预加载整个树
- ✅ 虚拟滚动优化（计划中）
- ✅ 懒加载大数组（计划中）

---

## 📝 后续计划

### 短期（已规划）

- [ ] 添加键盘快捷键（方向键导航）
- [ ] 支持拖拽调整详情面板宽度
- [ ] 列视图支持搜索高亮
- [ ] 添加"在当前列展开所有"功能

### 长期（考虑中）

- [ ] 支持编辑 JSON 值
- [ ] 支持导出选中的子树
- [ ] 添加书签功能（收藏常用路径）
- [ ] 支持对比两个 JSON 的差异

---

## 🙏 致谢

特别感谢 [JSON Hero](https://github.com/triggerdotdev/jsonhero-web) 项目提供的设计灵感和用户体验参考！

---

**更新日期：** 2025-10-29  
**版本：** v2.0.0  
**作者：** ChampionZhong

