# è¿œç¨‹æœåŠ¡å™¨ä½¿ç”¨æŒ‡å—ï¼ˆSlurm ç®¡ç†èŠ‚ç‚¹ï¼‰

æœ¬æŒ‡å—ä»‹ç»å¦‚ä½•åœ¨ Linux slurm ç®¡ç†èŠ‚ç‚¹ä¸Šè¿è¡Œ DataViewer é¡¹ç›®ï¼Œå¹¶é€šè¿‡ SSH ç«¯å£è½¬å‘åœ¨æœ¬åœ°æµè§ˆå™¨ä¸­è®¿é—®ã€‚

## ğŸ“‹ å‰ç½®è¦æ±‚

- å¯ä»¥ SSH è®¿é—® slurm ç®¡ç†èŠ‚ç‚¹
- ç®¡ç†èŠ‚ç‚¹ä¸Šå·²å®‰è£… Node.jsï¼ˆå»ºè®®ç‰ˆæœ¬ >= 16ï¼‰
- æœ¬åœ°ç”µè„‘å¯ä»¥é€šè¿‡ SSH è¿æ¥åˆ°ç®¡ç†èŠ‚ç‚¹

## ğŸš€ æ­¥éª¤ä¸€ï¼šåœ¨ç®¡ç†èŠ‚ç‚¹ä¸Šéƒ¨ç½²é¡¹ç›®

### 1. ä¸Šä¼ é¡¹ç›®åˆ°ç®¡ç†èŠ‚ç‚¹

ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»»ä¸€æ–¹å¼å°†é¡¹ç›®ä¸Šä¼ åˆ°ç®¡ç†èŠ‚ç‚¹ï¼š

**æ–¹å¼ Aï¼šä½¿ç”¨ scp å‘½ä»¤**

```bash
# åœ¨æœ¬åœ°ç”µè„‘æ‰§è¡Œ
scp -r /path/to/DataViewer username@slurm-host:/path/to/destination/
```

**æ–¹å¼ Bï¼šä½¿ç”¨ rsync å‘½ä»¤ï¼ˆæ¨èï¼Œæ”¯æŒå¢é‡åŒæ­¥ï¼‰**

```bash
# åœ¨æœ¬åœ°ç”µè„‘æ‰§è¡Œ
rsync -avz --exclude 'node_modules' \
  /path/to/DataViewer/ \
  username@slurm-host:/path/to/destination/DataViewer/
```

**æ–¹å¼ Cï¼šä½¿ç”¨ git clone**

```bash
# åœ¨ç®¡ç†èŠ‚ç‚¹ä¸Šæ‰§è¡Œ
git clone <your-repo-url> DataViewer
cd DataViewer
```

### 2. SSH ç™»å½•åˆ°ç®¡ç†èŠ‚ç‚¹

```bash
ssh username@slurm-host
```

### 3. è¿›å…¥é¡¹ç›®ç›®å½•å¹¶å®‰è£…ä¾èµ–

```bash
cd /path/to/DataViewer
npm install
```

å¦‚æœç®¡ç†èŠ‚ç‚¹ä¸Šæ²¡æœ‰ Node.jsï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼å®‰è£…ï¼š

```bash
# ä½¿ç”¨ conda å®‰è£…ï¼ˆæ¨èï¼‰
conda install -c conda-forge nodejs

# æˆ–ä½¿ç”¨ nvm å®‰è£…
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
source ~/.bashrc
nvm install 18
```

## ğŸ”Œ æ­¥éª¤äºŒï¼šé…ç½®ç«¯å£è½¬å‘

### æ–¹æ³• 1ï¼šå¯åŠ¨æœåŠ¡å™¨åé…ç½®ç«¯å£è½¬å‘ï¼ˆæ¨èï¼‰

**åœ¨ç®¡ç†èŠ‚ç‚¹ä¸Šå¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼š**

```bash
cd /path/to/DataViewer
npm run dev
```

ä½ ä¼šçœ‹åˆ°ç±»ä¼¼çš„è¾“å‡ºï¼š
```
  VITE v5.0.8  ready in 500 ms

  âœ  Local:   http://localhost:3000/
  âœ  Network: use --host to expose
  âœ  press h to show help
```

**åœ¨æœ¬åœ°ç”µè„‘æ–°å¼€ä¸€ä¸ªç»ˆç«¯ï¼Œå»ºç«‹ SSH éš§é“ï¼š**

```bash
ssh -L 3000:localhost:3000 username@slurm-host
```

å‚æ•°è¯´æ˜ï¼š
- `-L 3000:localhost:3000`ï¼šå°†æœ¬åœ°çš„ 3000 ç«¯å£è½¬å‘åˆ°è¿œç¨‹çš„ 3000 ç«¯å£
- æ ¼å¼ï¼š`-L [æœ¬åœ°ç«¯å£]:[è¿œç¨‹ä¸»æœº]:[è¿œç¨‹ç«¯å£]`

**åœ¨æœ¬åœ°æµè§ˆå™¨è®¿é—®ï¼š**

æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://localhost:3000`

### æ–¹æ³• 2ï¼šä¸€æ¡å‘½ä»¤å¯åŠ¨å¹¶è½¬å‘ï¼ˆé€‚åˆä¸´æ—¶ä½¿ç”¨ï¼‰

```bash
ssh -L 3000:localhost:3000 username@slurm-host "cd /path/to/DataViewer && npm run dev"
```

### æ–¹æ³• 3ï¼šä½¿ç”¨ä¸åŒçš„æœ¬åœ°ç«¯å£ï¼ˆé¿å…ç«¯å£å†²çªï¼‰

å¦‚æœæœ¬åœ° 3000 ç«¯å£å·²è¢«å ç”¨ï¼Œå¯ä»¥ä½¿ç”¨å…¶ä»–ç«¯å£ï¼š

```bash
# å°†è¿œç¨‹ 3000 ç«¯å£è½¬å‘åˆ°æœ¬åœ° 8080 ç«¯å£
ssh -L 8080:localhost:3000 username@slurm-host
```

ç„¶ååœ¨æœ¬åœ°æµè§ˆå™¨è®¿é—® `http://localhost:8080`

## ğŸ”§ æ­¥éª¤ä¸‰ï¼šé…ç½®æ›´çµæ´»çš„è®¿é—®æ–¹å¼

### ä¿®æ”¹ Vite é…ç½®ä»¥ç»‘å®šæ‰€æœ‰ç½‘ç»œæ¥å£

å¦‚æœä½ éœ€è¦ä»å…¶ä»–èŠ‚ç‚¹è®¿é—®ï¼Œå¯ä»¥ä¿®æ”¹ `vite.config.ts`ï¼š

```typescript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

export default defineConfig({
  plugins: [react()],
  server: {
    port: 3000,
    host: '0.0.0.0',  // æ·»åŠ è¿™è¡Œï¼Œå…è®¸å¤–éƒ¨è®¿é—®
    strictPort: true,  // å¯é€‰ï¼šå¦‚æœç«¯å£è¢«å ç”¨åˆ™å¤±è´¥
  },
})
```

ç„¶åå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è®¿é—®ï¼š

```bash
# æ–¹å¼ 1ï¼šè½¬å‘åˆ°ç®¡ç†èŠ‚ç‚¹çš„ç‰¹å®šç½‘ç»œæ¥å£
ssh -L 3000:<ç®¡ç†èŠ‚ç‚¹å†…ç½‘IP>:3000 username@slurm-host

# æ–¹å¼ 2ï¼šå¦‚æœç®¡ç†èŠ‚ç‚¹æœ‰å¤–ç½‘ IPï¼Œç›´æ¥è®¿é—®ï¼ˆéœ€è¦é˜²ç«å¢™å…è®¸ï¼‰
http://<ç®¡ç†èŠ‚ç‚¹IP>:3000
```

## ğŸ¯ å¸¸ç”¨åœºæ™¯å’ŒæŠ€å·§

### 1. åå°è¿è¡ŒæœåŠ¡å™¨

å¦‚æœä½ å¸Œæœ›æ–­å¼€ SSH åæœåŠ¡å™¨ç»§ç»­è¿è¡Œï¼š

```bash
# ä½¿ç”¨ screen
screen -S dataviewer
cd /path/to/DataViewer
npm run dev
# æŒ‰ Ctrl+A ç„¶å D åˆ†ç¦»ä¼šè¯

# é‡æ–°è¿æ¥
screen -r dataviewer

# æˆ–ä½¿ç”¨ tmux
tmux new -s dataviewer
cd /path/to/DataViewer
npm run dev
# æŒ‰ Ctrl+B ç„¶å D åˆ†ç¦»ä¼šè¯

# é‡æ–°è¿æ¥
tmux attach -t dataviewer

# æˆ–ä½¿ç”¨ nohup
nohup npm run dev > dataviewer.log 2>&1 &
```

### 2. é…ç½® SSH é…ç½®æ–‡ä»¶ç®€åŒ–è¿æ¥

ç¼–è¾‘ `~/.ssh/config`ï¼ˆåœ¨æœ¬åœ°ç”µè„‘ä¸Šï¼‰ï¼š

```
Host slurm
    HostName slurm-host-address
    User your-username
    LocalForward 3000 localhost:3000
```

ç„¶ååªéœ€æ‰§è¡Œï¼š
```bash
ssh slurm
```

å°±ä¼šè‡ªåŠ¨å»ºç«‹ç«¯å£è½¬å‘ã€‚

### 3. ä½¿ç”¨ç”Ÿäº§æ„å»º

å¯¹äºé•¿æœŸä½¿ç”¨ï¼Œå»ºè®®æ„å»ºç”Ÿäº§ç‰ˆæœ¬ï¼š

```bash
# åœ¨ç®¡ç†èŠ‚ç‚¹ä¸Šæ‰§è¡Œ
cd /path/to/DataViewer
npm run build

# ä½¿ç”¨ç®€å•çš„ HTTP æœåŠ¡å™¨è¿è¡Œ
npx serve -s dist -l 3000

# æˆ–ä½¿ç”¨ Python çš„ HTTP æœåŠ¡å™¨
cd dist
python3 -m http.server 3000
```

### 4. è‡ªå®šä¹‰ç«¯å£

å¦‚æœ 3000 ç«¯å£è¢«å ç”¨ï¼Œå¯ä»¥ä¿®æ”¹ç«¯å£ï¼š

**ä¿®æ”¹ `vite.config.ts`ï¼š**
```typescript
server: {
  port: 5173,  // æ”¹æˆå…¶ä»–ç«¯å£
}
```

**ç›¸åº”åœ°ä¿®æ”¹ SSH è½¬å‘å‘½ä»¤ï¼š**
```bash
ssh -L 5173:localhost:5173 username@slurm-host
```

### 5. é€šè¿‡è®¡ç®—èŠ‚ç‚¹è¿è¡Œ

å¦‚æœéœ€è¦åœ¨è®¡ç®—èŠ‚ç‚¹ä¸Šè¿è¡Œï¼ˆé€šè¿‡ slurm æäº¤ä»»åŠ¡ï¼‰ï¼š

åˆ›å»ºæäº¤è„šæœ¬ `run_dataviewer.sh`ï¼š

```bash
#!/bin/bash
#SBATCH --job-name=dataviewer
#SBATCH --nodes=1
#SBATCH --ntasks=1
#SBATCH --cpus-per-task=2
#SBATCH --time=08:00:00
#SBATCH --mem=4G

# åŠ è½½ Node.js ç¯å¢ƒ
module load nodejs  # å¦‚æœä½ çš„é›†ç¾¤ä½¿ç”¨ module

# æˆ–ä½¿ç”¨ conda
# source activate base
# conda activate your-env

cd /path/to/DataViewer
npm run dev -- --host 0.0.0.0 --port 3000
```

æäº¤ä»»åŠ¡ï¼š
```bash
sbatch run_dataviewer.sh
```

æŸ¥çœ‹ä»»åŠ¡è¿è¡Œçš„èŠ‚ç‚¹ï¼š
```bash
squeue -u $USER
```

å»ºç«‹åˆ°è®¡ç®—èŠ‚ç‚¹çš„è½¬å‘ï¼š
```bash
# å‡è®¾ä»»åŠ¡åœ¨ compute-node-01 ä¸Šè¿è¡Œ
ssh -L 3000:compute-node-01:3000 username@slurm-host
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å®‰å…¨æ€§**ï¼šç¡®ä¿åªåœ¨å—ä¿¡ä»»çš„ç½‘ç»œç¯å¢ƒä¸­ä½¿ç”¨ï¼Œä¸è¦æš´éœ²æ•æ„Ÿæ•°æ®
2. **ç«¯å£å†²çª**ï¼šå¦‚æœç«¯å£è¢«å ç”¨ï¼Œé€‰æ‹©å…¶ä»–ç«¯å£
3. **é˜²ç«å¢™**ï¼šå¦‚æœä½¿ç”¨ `host: '0.0.0.0'`ï¼Œç¡®ä¿é˜²ç«å¢™è§„åˆ™æ­£ç¡®é…ç½®
4. **èµ„æºä½¿ç”¨**ï¼šåœ¨ç®¡ç†èŠ‚ç‚¹ä¸Šè¿è¡Œæ—¶æ³¨æ„èµ„æºä½¿ç”¨ï¼Œé¿å…å½±å“å…¶ä»–ç”¨æˆ·
5. **ä¼šè¯ä¿æŒ**ï¼šä½¿ç”¨ screen/tmux ä¿æŒæœåŠ¡å™¨ä¼šè¯ï¼Œé¿å… SSH æ–­å¼€åè¿›ç¨‹ç»“æŸ

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼šç«¯å£è½¬å‘ä¸å·¥ä½œ

```bash
# æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«ç›‘å¬
netstat -tlnp | grep 3000

# æˆ–ä½¿ç”¨ ss
ss -tlnp | grep 3000

# æ£€æŸ¥è¿›ç¨‹
ps aux | grep vite
```

### é—®é¢˜ 2ï¼šæ— æ³•è®¿é—® localhost:3000

- ç¡®è®¤ SSH éš§é“å·²å»ºç«‹
- æ£€æŸ¥æœ¬åœ°ç«¯å£æ˜¯å¦è¢«å ç”¨ï¼š`lsof -i :3000`ï¼ˆmacOS/Linuxï¼‰
- å°è¯•è®¿é—® `http://127.0.0.1:3000`

### é—®é¢˜ 3ï¼šæƒé™é—®é¢˜

```bash
# ç¡®ä¿æœ‰æ‰§è¡Œæƒé™
chmod +x install.sh
./install.sh
```

### é—®é¢˜ 4ï¼šnpm install å¤±è´¥

```bash
# æ¸…ç†ç¼“å­˜é‡è¯•
rm -rf node_modules package-lock.json
npm cache clean --force
npm install
```

## ğŸ“š ç›¸å…³èµ„æº

- [SSH ç«¯å£è½¬å‘è¯¦è§£](https://www.ssh.com/academy/ssh/tunneling/example)
- [Vite æœåŠ¡å™¨é…ç½®æ–‡æ¡£](https://vitejs.dev/config/server-options.html)
- [Screen ä½¿ç”¨æŒ‡å—](https://www.gnu.org/software/screen/manual/screen.html)
- [Tmux ä½¿ç”¨æŒ‡å—](https://github.com/tmux/tmux/wiki)

---

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒé¡¹ç›®ä¸» README.md æˆ–æäº¤ Issueã€‚

